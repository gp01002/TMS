<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‰¾æŸåœ‹éš›èŠ³ç™‚ - VRæŒ‰æ‘©æ•™å­¸ç³»çµ± (éª¨æ¶åµæ¸¬ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: #333; overflow: hidden;
        }
        .game-container { width: 100vw; height: 100vh; position: relative; }
        
        /* æ­¡è¿ç•«é¢ */
        .welcome-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 1000; transition: opacity 0.5s;
        }
        .welcome-screen.hidden { opacity: 0; pointer-events: none; }
        .enter-btn {
            background: white; color: #667eea; border: none; padding: 15px 40px; font-size: 20px;
            border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 20px;
        }

        /* ä»‹é¢å±¤ */
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .pointer-events-auto { pointer-events: auto; }

        .status-bar {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.95); padding: 10px 30px; border-radius: 50px;
            font-weight: bold; color: #333; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: flex; gap: 15px; align-items: center;
        }

        /* å·¦å´ï¼šéšæ®µé¸æ“‡ */
        .control-panel {
            position: absolute; left: 20px; top: 80px; width: 260px;
            background: rgba(255,255,255,0.95); border-radius: 15px; padding: 15px;
            max-height: 80vh; overflow-y: auto; pointer-events: auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        /* å³å´ï¼šæ•™å­¸æŒ‡å¼• */
        .learning-panel {
            position: absolute; right: 20px; top: 80px; width: 320px;
            background: rgba(255,255,255,0.95); border-radius: 15px; padding: 20px;
            pointer-events: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .phase-btn {
            display: block; width: 100%; padding: 12px; margin-bottom: 8px;
            border: 1px solid #ddd; background: white; border-radius: 10px; cursor: pointer;
            text-align: left; font-weight: bold; transition: all 0.2s;
        }
        .phase-btn:hover { background: #f0f0f0; transform: translateX(3px); }
        .phase-btn.active { 
            background: linear-gradient(90deg, #667eea, #764ba2); 
            color: white; border: none; 
        }

        .step-card {
            background: #f8f9fa; border-left: 4px solid #667eea;
            padding: 15px; margin-bottom: 15px; border-radius: 5px;
        }
        .step-number { font-size: 14px; color: #667eea; font-weight: bold; margin-bottom: 5px; }
        .step-desc { font-size: 18px; font-weight: bold; margin-bottom: 8px; color: #333; }
        .step-note { font-size: 13px; color: #666; line-height: 1.5; }

        .nav-btn {
            background: #667eea; color: white; border: none; padding: 10px 20px;
            border-radius: 25px; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px;
        }
        .nav-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* Debug é¢æ¿ */
        .debug-panel {
            position: absolute; bottom: 10px; left: 10px; background: rgba(0,0,0,0.8);
            color: white; padding: 10px; border-radius: 5px; font-size: 12px; pointer-events: auto; width: 220px;
        }
        .debug-row { margin-bottom: 5px; display: flex; justify-content: space-between; }
        .debug-row label { width: 40px; }
        .debug-row input { flex: 1; margin-left: 10px; }

        .loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 20px; font-weight: bold; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            pointer-events: none; display: none;
        }
        .loading.show { display: block; }

        .feedback {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: #fff; padding: 15px 30px; border-radius: 30px;
            font-size: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 200;
        }
        
        #bone-status {
            font-size: 12px; padding: 4px 8px; border-radius: 4px; background: #eee;
        }
    </style>
</head>
<body>

    <div class="game-container">
        <div id="canvas-container" style="width:100%; height:100%; background:#000;"></div>

        <!-- æ­¡è¿é  -->
        <div class="welcome-screen" id="welcome-screen">
            <h1 style="color:white; margin-bottom:10px;">VR æŒ‰æ‘©æ•™å­¸ç³»çµ±</h1>
            <p style="color:white; font-size: 18px;">ç‘å…¸å¼è…¿éƒ¨æŒ‰æ‘©æª¢å®šæµç¨‹</p>
            <button class="enter-btn" onclick="startGame()">é–‹å§‹å­¸ç¿’</button>
        </div>

        <div class="ui-layer" id="ui-layer" style="display:none;">
            <div class="status-bar">
                <span>ğŸ« VR æ•™å®¤</span>
                <span id="bone-status">ğŸ” åµæ¸¬éª¨æ¶ä¸­...</span>
            </div>

            <!-- å·¦å´ï¼šæµç¨‹é¸æ“‡ -->
            <div class="control-panel">
                <h3 style="margin-bottom:15px; color:#555;">ğŸ“‹ å­¸ç¿’éšæ®µ</h3>
                <button class="phase-btn" onclick="setPhase(1)" id="p1">1. æº–å‚™èˆ‡èµ·å§‹å®‰æ’«</button>
                <button class="phase-btn" onclick="setPhase(2)" id="p2">2. å·¦è…¿æŒ‰æ‘©æ“ä½œ</button>
                <button class="phase-btn" onclick="setPhase(3)" id="p3">3. å³è…¿æŒ‰æ‘©æ“ä½œ</button>
                <button class="phase-btn" onclick="setPhase(4)" id="p4">4. çµå°¾èˆ‡å®‰æ’«</button>
                
                <hr style="margin: 15px 0; border:0; border-top:1px solid #eee;">
                
                <div style="font-size:12px; color:#888;">æ¨¡ç‰¹å…’é¸æ“‡</div>
                <div style="display:flex; gap:5px; margin-top:5px;">
                    <button class="phase-btn" style="padding:8px; text-align:center;" onclick="loadModel('male')">ğŸ‘¨ ç”·æ€§</button>
                    <button class="phase-btn" style="padding:8px; text-align:center;" onclick="loadModel('female')">ğŸ‘© å¥³æ€§</button>
                </div>
            </div>

            <!-- å³å´ï¼šæ­¥é©ŸæŒ‡å° -->
            <div class="learning-panel">
                <h3 style="margin-bottom:15px; color:#555;">ğŸ“– æ“ä½œæŒ‡å¼•</h3>
                
                <div id="step-display">
                    <div class="step-card">
                        <div class="step-number" id="step-id">è«‹é¸æ“‡éšæ®µ</div>
                        <div class="step-desc" id="step-text">é»é¸å·¦å´é¸å–®é–‹å§‹å­¸ç¿’</div>
                        <div class="step-note" id="step-note">--</div>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="nav-btn" style="background:#888;" onclick="prevStep()">ä¸Šä¸€æ­¥</button>
                    <button class="nav-btn" onclick="nextStep()">ä¸‹ä¸€æ­¥ â¡</button>
                </div>
                
                <div style="margin-top:15px; font-size:12px; color:#aaa; text-align:center;">
                    * VR æ¨¡å¼ä¸‹è«‹ä¾æ–‡å­—æç¤ºæ“ä½œ
                </div>
            </div>

            <!-- Debug é¢æ¿ï¼šé è¨­å€¼å·²æ›´æ–° -->
            <div class="debug-panel">
                <div style="margin-bottom:5px; color:#aaa;">ğŸ”§ ä½ç½®æ ¡æ­£</div>
                
                <div class="debug-row">
                    <label>Xå‰å¾Œ</label>
                    <!-- âœ¨ é è¨­å€¼æ”¹ç‚º -0.8 (è®“é ­éƒ¨å‡ºä¾†ä¸€é») -->
                    <input type="range" id="range-x" min="-5" max="5" step="0.1" value="-0.8" oninput="updatePos()">
                </div>
                
                <div class="debug-row">
                    <label>Yé«˜åº¦</label>
                    <!-- âœ¨ é è¨­å€¼æ”¹ç‚º 2.30 -->
                    <input type="range" id="range-y" min="0" max="10" step="0.1" value="2.30" oninput="updatePos()">
                </div>

                <div class="debug-row">
                    <label>Zå·¦å³</label>
                    <input type="range" id="range-z" min="-5" max="5" step="0.1" value="0" oninput="updatePos()">
                </div>

                <div style="margin-top:5px; text-align: center;">
                    <button style="padding:4px 10px; cursor:pointer;" onclick="resetCam()">é‡ç½®è¦–è§’</button>
                </div>
            </div>

            <div class="loading" id="loading-text">è¼‰å…¥æ•™å­¸è³‡æº...</div>
            <div class="feedback" id="feedback-text"></div>
        </div>
    </div>

    <script>
        const BASE_URL = "https://gp01002.github.io/TMS/";

        // âœ¨ å­¸ç¿’è³‡æ–™åº«
        const learningData = {
            1: [
                { id: "1.1", text: "åœ¨æ¯›å·¾ä¸Šä¿¯é †è‡³å¤§è…¿", note: "è¨­å®šå®¢æˆ¶ä½ç½®ï¼Œä¿æŒæ¥è§¸ã€‚", target: 'legs' },
                { id: "1.2", text: "ç”±å…©å´æ»‘ä¸‹è‡³è…³åº•", note: "å‹•ä½œè¼•æŸ”æµæš¢ã€‚", target: 'feet' },
                { id: "1.3", text: "å°‡æ¯›å·¾æ²åœ¨é›™è…¿ä¹‹é–“", note: "ç¢ºä¿æ¯›å·¾è¦†è“‹éš±ç§éƒ¨ä½ä¸¦å®šä½ã€‚", target: 'knees' },
                { id: "1.4", text: "é›™è…¿ç”±é˜¿åŸºé‡Œæ–¯è…±ä¸Šæ¸¸", note: "é›™è…¿åŒæ­¥æ“ä½œï¼Œé€²è¡Œåˆå§‹é•·æ¨ã€‚", target: 'legs' },
                { id: "1.5", text: "å°‡å³è…³è¦†è“‹", note: "ç¢ºèªæ“ä½œç›®æ¨™ç‚ºå·¦è…³ï¼Œä¿æŒå³è…³ä¿æš–ã€‚", target: 'right_leg' },
                { id: "1.6", text: "ä¸Šæ²¹", note: "å‡å‹»å¡—æŠ¹æŒ‰æ‘©æ²¹æ–¼é›™æ‰‹ã€‚", target: 'hands' },
                { id: "1.7", text: "å¤§å®‰æ’«", note: "å…©æ‰‹æ”¾åœ¨è…³åº•ï¼Œåœç•™ç‰‡åˆ»å»ºç«‹é€£çµã€‚", target: 'feet' }
            ],
            2: [
                { id: "2.1", text: "å·¦è…¿ï¼šæ‹‡æŒ‡ä¸¦æ’ï¼Œé•·æ¨è‡³å¤§è…¿", note: "ç”±ä¸‹å¾€ä¸Šï¼Œæ–½åŠ›å‡å‹»ã€‚", target: 'left_leg_long' },
                { id: "2.2", text: "ç”±å…©å´å›åŒ…", note: "å›ç¨‹å‹•ä½œï¼Œè¼•æ’«æ»‘å›ã€‚", target: 'left_leg' },
                { id: "2.3", text: "æ’¥ææŠ€å·§", note: "ç”±ä¸‹è‡³ä¸Šï¼Œåˆ†æ®µå‘å…©å´ææ‹‰è‚Œè‚‰ã€‚", target: 'left_calf' },
                { id: "2.4", text: "å¤§è…¿å…§å¤–å´æ“ä½œ", note: "ç”±å…§å´é–‹å§‹ï¼Œå†æ“ä½œå¤–å´ã€‚", target: 'left_thigh' },
                { id: "2.5", text: "é›™æ‰‹äº¤æ›¿å‘ä¸Šæ’«é †", note: "ä½¿ç”¨äº¤æ›¿æ‰‹é€²è¡Œé•·æ¨ï¼Œä¿æŒé€£è²«ã€‚", target: 'left_leg_long' },
                { id: "2.6", text: "å°è…¿å‘ä¸Šé•·æ¨è‡³å§”ä¸­ç©´", note: "æ³¨æ„è†è“‹å¾Œæ–¹åŠ›é“éœ€æ¸›è¼•ã€‚", target: 'left_calf' },
                { id: "2.7", text: "å°è…¿åˆ†ä¸‰ç­‰ä»½æ“ä½œ", note: "å…§ã€ä¸­ã€å¤–å´å„ä¸€æ¬¡ï¼Œä¾†å›å…±ä¸‰æ¬¡ã€‚", target: 'left_calf' },
                { id: "2.8", text: "æŠ¬è…³ 90 åº¦ï¼Œä¸€æ‰‹æ‰˜è…³ç›¤", note: "æº–å‚™é€²è¡Œè…³åº•æŒ‰æ‘© (è«‹æƒ³åƒå°‡è…³æŠ¬èµ·)ã€‚", target: 'left_foot_lift' } 
            ],
            3: [
                { id: "3.1", text: "å³è…¿ï¼šæ‹‡æŒ‡ä¸¦æ’é•·æ¨å¤§è…¿", note: "å³è…¿é–‹å§‹ï¼Œé‡è¤‡å·¦è…¿åŸºç¤å‹•ä½œã€‚", target: 'right_leg_long' },
                { id: "3.2", text: "ç”±å…©å´å›åŒ…", note: "ä¿æŒæ¥è§¸ã€‚", target: 'right_leg' },
                { id: "3.4", text: "S å‹æŠ“æ", note: "â˜… é‡é»æŠ€å·§ï¼šåŸ·è¡Œ S å‹ææ³•æ”¾é¬†è‚Œè‚‰ã€‚", target: 'right_calf' },
                { id: "3.5", text: "å¤§è…¿å…§å¤–å´æ“ä½œ", note: "ç”±å…§è‡ªå¤–ã€‚", target: 'right_thigh' },
                { id: "3.9", text: "æŠ¬è…³ 90 åº¦", note: "ä¸€æ‰‹æ‰˜è…³ç›¤ï¼Œæº–å‚™è…³åº•æŒ‰æ‘©ã€‚", target: 'right_foot_lift' },
                { id: "3.13", text: "æ¡åç§’", note: "æŒçºŒæŒ‰å£“è…³æŒå¿ƒåç§’ï¼Œçµ¦äºˆå®‰å®šæ„Ÿã€‚", target: 'right_foot' }
            ],
            4: [
                { id: "4.1", text: "æ¯›å·¾æ²å›ä¸­é–“", note: "æº–å‚™çµæŸå‹•ä½œã€‚", target: 'knees' },
                { id: "4.2", text: "å¤§å®‰æ’«", note: "é€²è¡Œæœ€çµ‚çš„å»£æ³›å®‰æ’«ï¼Œæ¶µè“‹é›™è…¿ã€‚", target: 'legs' },
                { id: "4.4", text: "è“‹ä¸Šæ¯›å·¾", note: "å®Œæ•´è¦†è“‹ï¼Œå®£å‘Šç™‚ç¨‹çµæŸã€‚", target: 'legs' }
            ]
        };

        let scene, camera, renderer, controls, model;
        let currentPhase = 1;
        let currentStepIndex = 0;
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let targets = [];

        function startGame() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('ui-layer').style.display = 'block';
            setTimeout(initThreeJS, 100);
        }

        function initThreeJS() {
            const container = document.getElementById('canvas-container');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);
            
            const grid = new THREE.GridHelper(20, 20);
            scene.add(grid);

            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 100);
            camera.position.set(0, 8, 5);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;

            const ambient = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambient);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(5, 10, 7);
            scene.add(dirLight);

            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('click', onCanvasClick);
            renderer.setAnimationLoop(animate);

            loadRoom();
            loadModel('male');
            setPhase(1);
        }

        function loadRoom() {
            const loader = new THREE.GLTFLoader();
            loader.load(BASE_URL + 'A01.glb', (gltf) => {
                const room = gltf.scene;
                room.scale.set(20, 20, 20);
                scene.add(room);
            });
        }

        function loadModel(type) {
            if (model) scene.remove(model);
            
            document.getElementById('loading-text').classList.add('show');
            const url = BASE_URL + (type === 'male' ? 'B01.glb' : 'B02.glb');

            const loader = new THREE.GLTFLoader();
            loader.load(url, (gltf) => {
                model = gltf.scene;
                updatePos(); 
                model.rotation.set(-Math.PI/2, 0, Math.PI/2);
                scene.add(model);
                
                // âœ¨ éª¨æ¶æª¢æŸ¥é‚è¼¯
                let hasBones = false;
                model.traverse((o) => {
                    if (o.isBone) {
                        hasBones = true;
                        // console.log("Found bone:", o.name); // é™¤éŒ¯ç”¨
                    }
                });

                const statusEl = document.getElementById('bone-status');
                if (hasBones) {
                    statusEl.innerText = "âœ… åµæ¸¬åˆ°éª¨æ¶ (å¯è£½ä½œå‹•ç•«)";
                    statusEl.style.background = "#d4edda";
                    statusEl.style.color = "#155724";
                } else {
                    statusEl.innerText = "âŒ ç„¡éª¨æ¶ (éœæ…‹æ¨¡å‹)";
                    statusEl.style.background = "#f8d7da";
                    statusEl.style.color = "#721c24";
                }

                updateTargets();
                document.getElementById('loading-text').classList.remove('show');
            });
        }

        function updatePos() {
            if (model) {
                const x = parseFloat(document.getElementById('range-x').value);
                const y = parseFloat(document.getElementById('range-y').value);
                const z = parseFloat(document.getElementById('range-z').value);
                model.position.set(x, y, z);
                updateTargets();
            }
        }

        // âœ¨ æ™ºæ…§å‹ç›®æ¨™é»ç”Ÿæˆ
        function updateTargets() {
            if (!model) return;
            if (targets.length > 0) targets.forEach(t => scene.remove(t));
            targets = [];

            const currentStep = learningData[currentPhase][currentStepIndex];
            if (!currentStep) return;
            const targetType = currentStep.target || 'legs';

            const basePos = model.position;
            let positions = [];

            switch(targetType) {
                case 'left_leg': 
                case 'left_leg_long':
                    positions = [
                        {x: 0.5, y: 0.5, z: 0.3}, {x: 1.0, y: 0.4, z: 0.3} 
                    ]; 
                    break;
                case 'right_leg': 
                case 'right_leg_long':
                    positions = [
                        {x: 0.5, y: 0.5, z: -0.3}, {x: 1.0, y: 0.4, z: -0.3} 
                    ]; 
                    break;
                case 'left_thigh':
                    positions = [{x: 0.2, y: 0.5, z: 0.3}]; break;
                case 'right_thigh':
                    positions = [{x: 0.2, y: 0.5, z: -0.3}]; break;
                case 'left_calf':
                    positions = [{x: 1.0, y: 0.4, z: 0.3}]; break;
                case 'right_calf':
                    positions = [{x: 1.0, y: 0.4, z: -0.3}]; break;
                case 'feet':
                    positions = [{x: 1.4, y: 0.4, z: 0.3}, {x: 1.4, y: 0.4, z: -0.3}]; break;
                case 'left_foot_lift':
                    positions = [{x: 1.4, y: 1.0, z: 0.3}]; break; // âœ¨ æŠ¬é«˜æç¤º
                case 'right_foot_lift':
                    positions = [{x: 1.4, y: 1.0, z: -0.3}]; break; // âœ¨ æŠ¬é«˜æç¤º
                case 'knees':
                    positions = [{x: 0.8, y: 0.5, z: 0}]; break;
                default: 
                    positions = [{x: 0.5, y: 0.5, z: 0.3}, {x: 0.5, y: 0.5, z: -0.3}];
            }

            const geo = new THREE.SphereGeometry(0.15, 16, 16);
            const mat = new THREE.MeshBasicMaterial({ color: 0x00ff00, transparent: true, opacity: 0.5 });

            positions.forEach(p => {
                const ball = new THREE.Mesh(geo, mat.clone());
                ball.position.set(
                    basePos.x + p.x, 
                    basePos.y + p.y, 
                    basePos.z + p.z
                );
                
                gsap.to(ball.material, { opacity: 0.1, duration: 0.8, yoyo: true, repeat: -1 });
                scene.add(ball);
                targets.push(ball);
            });
        }

        function setPhase(p) {
            currentPhase = p;
            currentStepIndex = 0;
            document.querySelectorAll('.phase-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('p' + p).classList.add('active');
            updateStepDisplay();
        }

        function nextStep() {
            if (currentStepIndex < learningData[currentPhase].length - 1) {
                currentStepIndex++;
                updateStepDisplay();
            } else {
                showFeedback("éšæ®µå®Œæˆï¼è«‹é¸æ“‡ä¸‹ä¸€éšæ®µ");
            }
        }

        function prevStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            const step = learningData[currentPhase][currentStepIndex];
            document.getElementById('step-id').innerText = `STEP ${step.id}`;
            document.getElementById('step-text').innerText = step.text;
            document.getElementById('step-note').innerText = step.note;
            updateTargets(); 
            showFeedback(`æ­¥é©Ÿ ${step.id}`);
        }

        function onCanvasClick(e) {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(targets);
            if (intersects.length > 0) {
                const pt = intersects[0].object.position;
                playEffect(pt);
                showFeedback("âœ… æ­£ç¢ºï¼", true);
            }
        }

        function playEffect(pos) {
            const ring = new THREE.Mesh(
                new THREE.RingGeometry(0.1, 0.2, 32),
                new THREE.MeshBasicMaterial({ color: 0xffff00, side: THREE.DoubleSide })
            );
            ring.position.copy(pos);
            ring.rotation.x = -Math.PI/2;
            scene.add(ring);
            gsap.to(ring.scale, {x:3, y:3, opacity:0, duration:0.5, onComplete:()=>scene.remove(ring)});
        }

        function showFeedback(msg, isSuccess) {
            const el = document.getElementById('feedback-text');
            el.innerText = msg;
            el.style.opacity = 1;
            el.style.background = isSuccess ? "rgba(0,150,0,0.8)" : "rgba(0,0,0,0.8)";
            clearTimeout(window.fbTimer);
            window.fbTimer = setTimeout(() => { el.style.opacity = 0; }, 1500);
        }

        function resetCam() { controls.reset(); }
        
        function onWindowResize() {
            if(camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }

        function animate() {
            if (controls) controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
